<!DOCTYPE html><html><head><title>Automated Surveys in Spring</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="Automated Surveys in Spring"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">Automated Surveys in Spring</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Learn to implement automated surveys in your Spring web app with Twilio.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="Introduction" class="chapter"><div data-file="src/main/java/com/twilio/automatedsurvey/servlets/SurveyServlet.java" data-highlight="35-57" class="step"><h2 id="about-this-application">About this application</h2>
<p>  This Java Servlets web application performs automated phone surveys
  using Twilio&#39;s API and TwiML. In addition to that,
  the application also displays the survey results. The majority of
  the application&#39;s routes will be accessed by Twilio itself since survey-takers
  will interact with the application through the phone voice call and SMS, not
  through the web.</p>
<p>  Questions in surveys might be voice responses, numeric responses and yes-no responses
  when the survey is requested by a phonecall. When the user interacts with the survey
  through SMS all responses are handled as text. The source for the application <a href="https://github.com/TwilioDevEd/automated-survey-servlets">can be found in
  GitHub.</a></p>
<p>  In this tutorial, we&#39;ll highlight the code that interacts with
  Twilio and in turn makes the application tick.  <a href="https://github.com/TwilioDevEd/automated-survey-spring/blob/master/README.md">Check out the project
  README on
  GitHub</a>
  to see how to run the code yourself.</p>
<p>  Let&#39;s get started! Click the right arrow above to advance to the next code snippet.</p>
<h4 id="see-also">See Also</h4>
<ul>
<li><a href="https://www.twilio.com/docs/java/install">The Twilio Java Helper Library</a>.</li>
<li><a href="https://www.twilio.com/docs/quickstart/java">TwiML: Java Quickstart Tutorial</a>.</li>
<li><a href="https://www.twilio.com/docs/api/twiml">TwiMLTM: the Twilio Markup Language</a>.</li>
</ul>
</div><div data-file=".env.example" class="step"><h2 id="configure-the-application">Configure the application</h2>
<p>The application requirements are minimal. The only necessary
component is a running PostgreSQL database. Copy the sample configuration file <code>.env.example</code>
and edit it to match your configuration. Once you have edited the <code>.env.example</code> file,
if you are using a unix operating system, just use the source command to load the variables into your environment:</p>
<pre><code>source .env.example
</code></pre><p>If you are using a different operating system, make sure that all the variables from the .env.example
file are loaded into your environment.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/user/account/phone-numbers/incoming">Your Available Phone Numbers</a></li>
</ul>
</div><div data-file="src/main/java/com/twilio/automatedsurvey/servlets/SurveyServlet.java" data-highlight="46-52, 59-63" class="step"><h2 id="create-a-survey">Create a survey</h2>
<p>In order to perform automated surveys we first need to have some questions to ask. For your convenience,
the application&#39;s repository already includes one survey that will be loaded into the database. If the database
is configured correctly every time that a user requests a survey, the application will create a new one
for that user.</p>
<p>You can modify the questions from the survey by editing the
<a href="https://github.com/TwilioDevEd/automated-survey-servlets/blob/master/src/main/resources/survey.json">survey.json</a>
file located in the application resources folder and re-running the app.</p>
<p>We want users to take our survey, so next we are going implement
the interaction of the caller with the application.</p>
</div><div data-file="src/main/java/com/twilio/automatedsurvey/servlets/SurveyServlet.java" data-highlight="46-52" class="step"><h2 id="respond-to-twilio-s-initial-request">Respond to Twilio&#39;s initial request</h2>
<p>Whenever one of <a href="https://www.twilio.com/user/account/phone-numbers/incoming">your Twilio phone
numbers</a>
receives a call or a SMS, Twilio will make an HTTP request to the voice request
URL configured under it with the HTTP method specified (either GET
or POST).</p>
<p>For this application Twilio should be configured to make a GET request to
the application&#39;s <code>/survey</code> endpoint. Here the application will create and return a new survey,
and after stating its name and welcoming the user to it using TwiML&#39;s
<a href="https://www.twilio.com/docs/api/twiml/say"><code>&lt;Say&gt;</code></a> verb, it will redirect the call
to the first question using the <a href="https://www.twilio.com/docs/api/twiml/redirect"><code>&lt;Redirect&gt;</code></a>.
verb.</p>
<p>Next we will handle the request made after the redirect.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/docs/api/twiml/redirect">TwiML Voice: &lt;Redirect&gt;</a></li>
<li><a href="https://www.twilio.com/platform/webhooks">Twilio webhooks</a></li>
<li><a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html">HTTP methods</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/your_response">TwiML Voice: Your Response</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/say">TwiML Voice: &lt;Say&gt;</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/redirect">TwiML Voice: &lt;Redirect&gt;</a></li>
</ul>
</div><div data-file="src/main/java/com/twilio/automatedsurvey/servlets/QuestionServlet.java" data-highlight="29-59" class="step"><h2 id="ask-the-caller-a-question">Ask the caller a question</h2>
<p>At this point the Twilio client has made a request for the first
question. We will use the
<a href="https://github.com/twilio/twilio-java">twilio-java</a> library to
generate a response. First we will ask a question, then say
instructions on how to answer that question and finally
record the caller&#39;s answer to the question. It&#39;s important to
keep in mind that instructions on how to answer a question depend on the
type of question we ask. We also need record the answer
differently if a given question requires keypad input or voice
input.</p>
</div><div data-file="src/main/java/com/twilio/automatedsurvey/servlets/SurveyServlet.java" data-highlight="55-99" class="step"><h2 id="record-the-caller-s-response">Record the caller&#39;s response</h2>
<p>Recording the answer is slightly more involved. If the question
is of kind &quot;voice&quot; then we use the
<a href="https://www.twilio.com/docs/api/twiml/record"><code>&lt;Record&gt;</code></a>
verb. However, if we expect dialpad input we use the the
<a href="https://www.twilio.com/docs/api/twiml/gather"><code>&lt;Gather&gt;</code></a>
verb. Both verbs take an <code>action</code> attribute and a <code>method</code>
attribute. Twilio&#39;s client will use both attributes to make a
request we can use to store the caller&#39;s answer to the question.</p>
<p>Since we want to create a new resource in our server, the HTTP
method will be <code>POST</code> for both <code>&lt;Gather&gt;</code> and <code>&lt;Record&gt;</code>. The
<code>action</code> URL will be <code>/save_response?qid=&lt;question_id&gt;</code>
for both TwiML verbs.</p>
<p>Now that the caller has answered our question we want to store
the answer.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/docs/api/twiml/gather">TwiML Voice: &lt;Gather&gt;</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/record">TwiML Voice: &lt;Record&gt;</a></li>
</ul>
</div><div data-file="src/main/java/com/twilio/automatedsurvey/servlets/SurveyServlet.java" data-highlight="33-91" class="step"><h2 id="store-a-question-s-answer">Store a question&#39;s answer</h2>
<p>Now Twilio has made a POST request to the
<code>/survey?survey=&lt;survey_id&gt;&amp;question=&lt;question_id&gt;</code> URL.  The request includes
everything we need to record the caller&#39;s answer to our
question. Aside from the <code>&lt;survey_id&gt;</code> and <code>&lt;question_id&gt;</code> parameters,
Twilio includes a <a href="https://www.twilio.com/docs/api/twiml/twilio_request">wealth of information</a>
with every request. For this sample application we will store
the <code>RecordingUrl</code> or <code>Digits</code> parameter for voice and
yes-no/numeric answers accordingly.</p>
<p>Most surveys include more than a single question so we must now
redirect the user to the next question in this survey using the
<a href="https://www.twilio.com/docs/api/twiml/redirect">&lt;Redirect&gt;</a> verb
again.</p>
<p>If there are no more questions available on the survey, the user will be notified via the
<a href="https://www.twilio.com/docs/api/twiml/say">say verb</a> and then hangup the call using the
<a href="https://www.twilio.com/docs/api/twiml/hangup">hangup verb</a></p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/docs/api/twiml/twilio_request">TwiML Voice: Twilio&#39;s Request</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/redirect">TwiML Voice: &lt;Redirect&gt;</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/say">TwiML Voice: &lt;Say&gt;</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/hangup">TwiML Voice: &lt;Hangup&gt;</a></li>
</ul>
</div><div data-file="src/main/java/com/twilio/automatedsurvey/servlets/SurveyServlet.java" data-highlight="30-52" class="step"><h2 id="display-the-survey-results">Display the survey results</h2>
<p>For this route we simply query the database using a JPA query
and then display a list of all the surveys taken and its questons
with the respective answerts.</p>
<p>You can access this page in the applications root route <code>/</code>.</p>
</div><div class="step"><h2 id="where-to-next-">Where to next?</h2>
<p>It&#39;s done! If you have configured one of your voice-enable Twilio
numbers to the application built in this tutorial you should be
able to take the survey and see the results under the root route of
the application. We hope you found this sample application
useful.  If you&#39;re a Java developer working with Twilio, you
might enjoy these other tutorials:</p>
<h3 id="-appointment-reminders-https-www-twilio-com-docs-howto-walkthrough-appointment-reminders-java-spark-"><a href="https://www.twilio.com/docs/howto/walkthrough/appointment-reminders/java/spark">Appointment Reminders</a></h3>
<p>Automate the process of reaching out to your customers in advance of an upcoming appointment.</p>
<h3 id="-how-tos-and-example-code-https-www-twilio-com-docs-howto-"><a href="https://www.twilio.com/docs/howto">How-Tos and Example Code</a></h3>
<p>Tutorials in different programming languages</p>
<h3 id="did-this-help-">Did this help?</h3>
<p>Thanks for checking out this tutorial! If you have any feedback to share with us,
we&#39;d love to hear it. Tweet <a href="twitter.com/twilio">@twilio</a> to let us know what you think.</p>
</div></div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="src/main/java/com/twilio/automatedsurvey/servlets/SurveyServlet.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLmF1dG9tYXRlZHN1cnZleS5zZXJ2bGV0czsKCmltcG9ydCBjb20uZ29vZ2xlLmluamVjdC5JbmplY3Q7CmltcG9ydCBjb20uZ29vZ2xlLmluamVjdC5wZXJzaXN0LlRyYW5zYWN0aW9uYWw7CmltcG9ydCBjb20udHdpbGlvLmF1dG9tYXRlZHN1cnZleS5zdXJ2ZXkuUXVlc3Rpb247CmltcG9ydCBjb20udHdpbGlvLmF1dG9tYXRlZHN1cnZleS5zdXJ2ZXkuU3VydmV5OwppbXBvcnQgY29tLnR3aWxpby5hdXRvbWF0ZWRzdXJ2ZXkuc3VydmV5LmxvYWRlci5TdXJ2ZXlMb2FkZXI7CmltcG9ydCBjb20udHdpbGlvLmF1dG9tYXRlZHN1cnZleS5zdXJ2ZXkuU3VydmV5UmVwb3NpdG9yeTsKaW1wb3J0IGNvbS50d2lsaW8uc2RrLnZlcmJzLio7CgppbXBvcnQgamF2YXguaW5qZWN0LlNpbmdsZXRvbjsKaW1wb3J0IGphdmF4LnNlcnZsZXQuU2VydmxldENvbmZpZzsKaW1wb3J0IGphdmF4LnNlcnZsZXQuU2VydmxldEV4Y2VwdGlvbjsKaW1wb3J0IGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2VydmxldDsKaW1wb3J0IGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2VydmxldFJlcXVlc3Q7CmltcG9ydCBqYXZheC5zZXJ2bGV0Lmh0dHAuSHR0cFNlcnZsZXRSZXNwb25zZTsKaW1wb3J0IGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2Vzc2lvbjsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwuT3B0aW9uYWw7CgpAU2luZ2xldG9uCnB1YmxpYyBjbGFzcyBTdXJ2ZXlTZXJ2bGV0IGV4dGVuZHMgSHR0cFNlcnZsZXR7CiAgICBwcml2YXRlIFN1cnZleVJlcG9zaXRvcnkgc3VydmV5UmVwbzsKICAgIHByaXZhdGUgVHdpbGlvUmVzcG9uc2VGYWN0b3J5IHR3aWxpb1Jlc3BvbnNlRmFjdG9yeTsKICAgIHByaXZhdGUgUmVzcG9uc2VXcml0ZXIgcmVzcG9uc2VXcml0ZXI7CgogICAgQEluamVjdAogICAgcHVibGljIFN1cnZleVNlcnZsZXQoU3VydmV5UmVwb3NpdG9yeSBzdXJ2ZXlSZXBvLCBUd2lsaW9SZXNwb25zZUZhY3RvcnkgdHdpbGlvUmVzcG9uc2VGYWN0b3J5LAogICAgICAgICAgICAgICAgICAgICAgICAgUmVzcG9uc2VXcml0ZXIgcmVzcG9uc2VXcml0ZXIpIHsKICAgICAgICB0aGlzLnN1cnZleVJlcG8gPSBzdXJ2ZXlSZXBvOwogICAgICAgIHRoaXMudHdpbGlvUmVzcG9uc2VGYWN0b3J5ID0gdHdpbGlvUmVzcG9uc2VGYWN0b3J5OwogICAgICAgIHRoaXMucmVzcG9uc2VXcml0ZXIgPSByZXNwb25zZVdyaXRlcjsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGRvR2V0KEh0dHBTZXJ2bGV0UmVxdWVzdCByZXF1ZXN0LCBIdHRwU2VydmxldFJlc3BvbnNlIHJlc3BvbnNlKSB7CiAgICAgICAgSHR0cFNlc3Npb24gc2Vzc2lvbiA9IHJlcXVlc3QuZ2V0U2Vzc2lvbih0cnVlKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGlzU21zQW5zd2VyKHJlcXVlc3QpKSB7CiAgICAgICAgICAgICAgICBTdHJpbmcgc3VydmV5ID0gc2Vzc2lvbi5nZXRBdHRyaWJ1dGUoImxhc3RTdXJ2ZXkiKS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgU3RyaW5nIGxhc3RRdWVzdGlvbiA9IHNlc3Npb24uZ2V0QXR0cmlidXRlKCJsYXN0UXVlc3Rpb24iKS50b1N0cmluZygpOwoKICAgICAgICAgICAgICAgIHJlZGlyZWN0VG9BbnN3ZXJFbmRwb2ludChyZXNwb25zZSwgc3VydmV5LCBsYXN0UXVlc3Rpb24pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgU3VydmV5IG5ld1N1cnZleSA9IGNyZWF0ZVN1cnZleUluc3RhbmNlKCk7CiAgICAgICAgICAgICAgICBUd2lNTFJlc3BvbnNlIHR3aWxpb1Jlc3BvbnNlOwoKICAgICAgICAgICAgICAgIFN0cmluZyBtZXNzYWdlID0gU3RyaW5nLmZvcm1hdCgiV2VsY29tZSB0byB0aGUgJXMgc3VydmV5IiwgbmV3U3VydmV5LmdldFRpdGxlKCkpOwogICAgICAgICAgICAgICAgVmVyYiB3ZWxjb21lTWVzc2FnZSA9IGlzU21zKHJlcXVlc3QpID8gbmV3IE1lc3NhZ2UobWVzc2FnZSkgOiBuZXcgU2F5KG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgdHdpbGlvUmVzcG9uc2UgPSB0d2lsaW9SZXNwb25zZUZhY3RvcnkuYnVpbGQobmV3U3VydmV5LCB3ZWxjb21lTWVzc2FnZSk7CiAgICAgICAgICAgICAgICB0aGlzLnJlc3BvbnNlV3JpdGVyLndyaXRlSW4ocmVzcG9uc2UsIHR3aWxpb1Jlc3BvbnNlLnRvRXNjYXBlZFhNTCgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7CiAgICAgICAgfQogICAgfQoKICAgIEBUcmFuc2FjdGlvbmFsCiAgICBwcml2YXRlIFN1cnZleSBjcmVhdGVTdXJ2ZXlJbnN0YW5jZSgpIHsKICAgICAgICBTdXJ2ZXlMb2FkZXIgbG9hZGVyID0gbmV3IFN1cnZleUxvYWRlcigic3VydmV5Lmpzb24iKTsKICAgICAgICByZXR1cm4gc3VydmV5UmVwby5hZGQobG9hZGVyLmxvYWQoKSk7CiAgICB9CgogICAgcHJpdmF0ZSBUd2lNTFJlc3BvbnNlIGJ1aWxkV2VsY29tZU1lc3NhZ2UoSHR0cFNlcnZsZXRSZXF1ZXN0IHJlcXVlc3QsIE9wdGlvbmFsPFN1cnZleT4gbGFzdFN1cnZleSkgdGhyb3dzIFR3aU1MRXhjZXB0aW9uIHsKICAgICAgICBUd2lNTFJlc3BvbnNlIHR3aWxpb1Jlc3BvbnNlOwogICAgICAgIFN0cmluZyBtZXNzYWdlID0gU3RyaW5nLmZvcm1hdCgiV2VsY29tZSB0byB0aGUgJXMgc3VydmV5IiwgbGFzdFN1cnZleS5tYXAoKFN1cnZleSBzKSAtPiBzLmdldFRpdGxlKCkpLm9yRWxzZSgiIikpOwogICAgICAgIFZlcmIgd2VsY29tZU1lc3NhZ2UgPSBpc1NtcyhyZXF1ZXN0KSA/IG5ldyBNZXNzYWdlKG1lc3NhZ2UpIDogbmV3IFNheShtZXNzYWdlKTsKICAgICAgICB0d2lsaW9SZXNwb25zZSA9IHR3aWxpb1Jlc3BvbnNlRmFjdG9yeS5idWlsZChsYXN0U3VydmV5Lm9yRWxzZShudWxsKSwgd2VsY29tZU1lc3NhZ2UpOwogICAgICAgIHJldHVybiB0d2lsaW9SZXNwb25zZTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgcmVkaXJlY3RUb0Fuc3dlckVuZHBvaW50KEh0dHBTZXJ2bGV0UmVzcG9uc2UgcmVzcG9uc2UsIFN0cmluZyBzdXJ2ZXksIFN0cmluZyBsYXN0UXVlc3Rpb24pIHRocm93cyBUd2lNTEV4Y2VwdGlvbiwgSU9FeGNlcHRpb24gewogICAgICAgIFR3aU1MUmVzcG9uc2UgdHdpTUxSZXNwb25zZSA9IG5ldyBUd2lNTFJlc3BvbnNlKCk7CiAgICAgICAgUmVkaXJlY3QgcmVkaXJlY3QgPSBuZXcgUmVkaXJlY3QoU3RyaW5nLmZvcm1hdCgic3VydmV5P3N1cnZleT0lcyZxdWVzdGlvbj0lcyIsIHN1cnZleSwgbGFzdFF1ZXN0aW9uKSk7CiAgICAgICAgcmVkaXJlY3Quc2V0TWV0aG9kKCJQT1NUIik7CiAgICAgICAgdHdpTUxSZXNwb25zZS5hcHBlbmQocmVkaXJlY3QpOwogICAgICAgIHRoaXMucmVzcG9uc2VXcml0ZXIud3JpdGVJbihyZXNwb25zZSwgdHdpTUxSZXNwb25zZS50b0VzY2FwZWRYTUwoKSk7CiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIGlzU21zQW5zd2VyKEh0dHBTZXJ2bGV0UmVxdWVzdCByZXF1ZXN0KSB7CiAgICAgICAgSHR0cFNlc3Npb24gc2Vzc2lvbiA9IHJlcXVlc3QuZ2V0U2Vzc2lvbih0cnVlKTsKICAgICAgICByZXR1cm4gc2Vzc2lvbi5nZXRBdHRyaWJ1dGUoImxhc3RTdXJ2ZXkiKSAhPSBudWxsOwogICAgfQoKICAgIHByaXZhdGUgYm9vbGVhbiBpc1NtcyhIdHRwU2VydmxldFJlcXVlc3QgcmVxdWVzdCkgewogICAgICAgIHJldHVybiByZXF1ZXN0LmdldFBhcmFtZXRlcigiTWVzc2FnZVNpZCIpICE9IG51bGw7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBAVHJhbnNhY3Rpb25hbAogICAgcHVibGljIHZvaWQgZG9Qb3N0KEh0dHBTZXJ2bGV0UmVxdWVzdCByZXF1ZXN0LCBIdHRwU2VydmxldFJlc3BvbnNlIHJlc3BvbnNlKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIExvbmcgc3VydmV5SWQgPSBMb25nLnBhcnNlTG9uZyhyZXF1ZXN0LmdldFBhcmFtZXRlcigic3VydmV5IikpOwoKICAgICAgICBTdXJ2ZXkgc3VydmV5ID0gc3VydmV5UmVwby5maW5kKHN1cnZleUlkKS5vckVsc2VUaHJvdygoKSAtPiBuZXcgUnVudGltZUV4Y2VwdGlvbigiU3VydmV5IHdhcyBub3QgZm91bmQiKSk7CgogICAgICAgIFF1ZXN0aW9uIGFuc3dlcmVkUXVlc3Rpb24gPSBpc1NtcyhyZXF1ZXN0KSA/IHN1cnZleS5hbnN3ZXJTTVMocmVxdWVzdC5nZXRQYXJhbWV0ZXJNYXAoKSkgOgogICAgICAgICAgICAgICAgc3VydmV5LmFuc3dlckNhbGwocmVxdWVzdC5nZXRQYXJhbWV0ZXJNYXAoKSk7CgogICAgICAgIHN1cnZleVJlcG8udXBkYXRlKHN1cnZleSk7CgogICAgICAgIE9wdGlvbmFsPFF1ZXN0aW9uPiBuZXh0UXVlc3Rpb24gPSBzdXJ2ZXkuZ2V0TmV4dFF1ZXN0aW9uKGFuc3dlcmVkUXVlc3Rpb24pOwoKICAgICAgICBUd2lNTFJlc3BvbnNlIHR3aU1MUmVzcG9uc2UgPSBuZXh0UXVlc3Rpb24ubWFwKChRdWVzdGlvbiBxKSAtPiBidWlsZFJlZGlyZWN0VHdpTUxNZXNzYWdlKHN1cnZleUlkLCBxKSkKICAgICAgICAgICAgICAgIC5vckVsc2UoYnVpbGRUaGFua1lvdVR3aU1MUmVzcG9uc2Uoc3VydmV5LmdldFRpdGxlKCksIHJlcXVlc3QpKTsKCiAgICAgICAgcmVzcG9uc2VXcml0ZXIud3JpdGVJbihyZXNwb25zZSwgdHdpTUxSZXNwb25zZS50b0VzY2FwZWRYTUwoKSk7CiAgICB9CgogICAgcHJpdmF0ZSBUd2lNTFJlc3BvbnNlIGJ1aWxkVGhhbmtZb3VUd2lNTFJlc3BvbnNlKFN0cmluZyBzdXJ2ZXlUaXRsZSwgSHR0cFNlcnZsZXRSZXF1ZXN0IHJlcXVlc3QpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBUd2lNTFJlc3BvbnNlIHJlc3BvbnNlID0gbmV3IFR3aU1MUmVzcG9uc2UoKTsKCiAgICAgICAgICAgIFZlcmIgbWVzc2FnZTsKICAgICAgICAgICAgU3RyaW5nIHJlYWxNZXNzYWdlID0gU3RyaW5nLmZvcm1hdCgiVGhhbmsgeW91IGZvciB0YWtpbmcgdGhlICVzIHN1cnZleS4gR29vZCBieWUuIiwgc3VydmV5VGl0bGUpOwogICAgICAgICAgICBpZiAoaXNTbXMocmVxdWVzdCkpIHsKICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBuZXcgTWVzc2FnZShyZWFsTWVzc2FnZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtZXNzYWdlID0gbmV3IFNheShyZWFsTWVzc2FnZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJlc3BvbnNlLmFwcGVuZChtZXNzYWdlKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlOwogICAgICAgIH0gY2F0Y2ggKFR3aU1MRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24oZSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgVHdpTUxSZXNwb25zZSBidWlsZFJlZGlyZWN0VHdpTUxNZXNzYWdlKExvbmcgc3VydmV5SWQsIFF1ZXN0aW9uIHEpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBUd2lNTFJlc3BvbnNlIHJlc3BvbnNlID0gbmV3IFR3aU1MUmVzcG9uc2UoKTsKICAgICAgICAgICAgUmVkaXJlY3QgcmVkaXJlY3QgPSBuZXcgUmVkaXJlY3QoU3RyaW5nLmZvcm1hdCgicXVlc3Rpb24/c3VydmV5PSVzJnF1ZXN0aW9uPSVzIiwgc3VydmV5SWQsIHEuZ2V0SWQoKSkpOwogICAgICAgICAgICByZWRpcmVjdC5zZXRNZXRob2QoIkdFVCIpOwogICAgICAgICAgICByZXNwb25zZS5hcHBlbmQocmVkaXJlY3QpOwogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICAgICAgfSBjYXRjaCAoVHdpTUxFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgUnVudGltZUV4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9CgoKfQo=</textarea>
<textarea class="saurus-file" data-file=".env.example" data-mode="text">IyBFbnZpcm9ubWVudCB2YXJpYWJsZXMgZm9yIGF1dG9tYXRlZC1zdXJ2ZXktc3ByaW5nCgojIEFwcCBzZXR0aW5ncwpleHBvcnQgREFUQUJBU0VfVVJMPQpleHBvcnQgREFUQUJBU0VfVVNFUj0KZXhwb3J0IERBVEFCQVNFX1BBU1NXT1JEPQpleHBvcnQgVEVTVF9EQVRBQkFTRV9VUkw9CmV4cG9ydCBURVNUX0RBVEFCQVNFX1VTRVI9CmV4cG9ydCBURVNUX0RBVEFCQVNFX1BBU1NXT1JEPQoKCiMgRGlzYWJsZSBQb3N0Z3JlcyBTU0wgKG11c3Qgc2V0IHRoaXMgb25lIGlmIGRhdGFiYXNlIGRvZXNuJ3QgaGF2ZSBTU0wgZW5hYmxlZCkKVFdJTElPX0RJU0FCTEVfREJfU1NMPXRydWUK</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/automatedsurvey/servlets/QuestionServlet.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLmF1dG9tYXRlZHN1cnZleS5zZXJ2bGV0czsKCmltcG9ydCBjb20uZ29vZ2xlLmluamVjdC5JbmplY3Q7CmltcG9ydCBjb20uZ29vZ2xlLmluamVjdC5TaW5nbGV0b247CmltcG9ydCBjb20udHdpbGlvLmF1dG9tYXRlZHN1cnZleS5zZXJ2bGV0cy50d2ltbHF1ZXN0aW9ucy5BYnN0cmFjdFR3aU1MUXVlc3Rpb25GYWN0b3J5OwppbXBvcnQgY29tLnR3aWxpby5hdXRvbWF0ZWRzdXJ2ZXkuc2VydmxldHMudHdpbWxxdWVzdGlvbnMuVHdpTUxRdWVzdGlvbjsKaW1wb3J0IGNvbS50d2lsaW8uYXV0b21hdGVkc3VydmV5LnN1cnZleS5RdWVzdGlvbjsKaW1wb3J0IGNvbS50d2lsaW8uYXV0b21hdGVkc3VydmV5LnN1cnZleS5TdXJ2ZXk7CmltcG9ydCBjb20udHdpbGlvLmF1dG9tYXRlZHN1cnZleS5zdXJ2ZXkuU3VydmV5UmVwb3NpdG9yeTsKCmltcG9ydCBqYXZheC5zZXJ2bGV0Lmh0dHAuSHR0cFNlcnZsZXQ7CmltcG9ydCBqYXZheC5zZXJ2bGV0Lmh0dHAuSHR0cFNlcnZsZXRSZXF1ZXN0OwppbXBvcnQgamF2YXguc2VydmxldC5odHRwLkh0dHBTZXJ2bGV0UmVzcG9uc2U7CmltcG9ydCBqYXZheC5zZXJ2bGV0Lmh0dHAuSHR0cFNlc3Npb247CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLk9wdGlvbmFsOwoKQFNpbmdsZXRvbgpwdWJsaWMgY2xhc3MgUXVlc3Rpb25TZXJ2bGV0IGV4dGVuZHMgSHR0cFNlcnZsZXQgewogICAgcHJpdmF0ZSBTdXJ2ZXlSZXBvc2l0b3J5IHN1cnZleVJlcG9zaXRvcnk7CiAgICBwcml2YXRlIFJlc3BvbnNlV3JpdGVyIHJlc3BvbnNlV3JpdGVyOwoKICAgIEBJbmplY3QKICAgIHB1YmxpYyBRdWVzdGlvblNlcnZsZXQoU3VydmV5UmVwb3NpdG9yeSBzdXJ2ZXlSZXBvc2l0b3J5LCBSZXNwb25zZVdyaXRlciByZXNwb25zZVdyaXRlcikgewogICAgICAgIHRoaXMuc3VydmV5UmVwb3NpdG9yeSA9IHN1cnZleVJlcG9zaXRvcnk7CiAgICAgICAgdGhpcy5yZXNwb25zZVdyaXRlciA9IHJlc3BvbnNlV3JpdGVyOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGRvR2V0KEh0dHBTZXJ2bGV0UmVxdWVzdCByZXF1ZXN0LCBIdHRwU2VydmxldFJlc3BvbnNlIHJlc3BvbnNlKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIExvbmcgc3VydmV5SWQgPSBMb25nLnBhcnNlTG9uZyhyZXF1ZXN0LmdldFBhcmFtZXRlcigic3VydmV5IikpOwogICAgICAgIFN0cmluZyBxdWVzdGlvbklkID0gcmVxdWVzdC5nZXRQYXJhbWV0ZXIoInF1ZXN0aW9uIik7CgoKICAgICAgICBPcHRpb25hbDxTdXJ2ZXk+IHN1cnZleSA9IHN1cnZleVJlcG9zaXRvcnkuZmluZChzdXJ2ZXlJZCk7CiAgICAgICAgT3B0aW9uYWw8UXVlc3Rpb24+IHF1ZXN0aW9uOwoKICAgICAgICBpZiAocXVlc3Rpb25JZCA9PSBudWxsKSB7CiAgICAgICAgICAgIHF1ZXN0aW9uID0gc3VydmV5LmZsYXRNYXAoKFN1cnZleSBzKSAtPiBzLmdldEZpcnN0UXVlc3Rpb24oKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgTG9uZyBwYXJzZWRRdWVzdGlvbklkID0gTG9uZy5wYXJzZUxvbmcocXVlc3Rpb25JZCk7CiAgICAgICAgICAgIHF1ZXN0aW9uID0gc3VydmV5LmZsYXRNYXAoKFN1cnZleSBzKSAtPiBzLnF1ZXN0aW9uQnlJZChwYXJzZWRRdWVzdGlvbklkKSk7CiAgICAgICAgfQoKICAgICAgICBBYnN0cmFjdFR3aU1MUXVlc3Rpb25GYWN0b3J5IGZhY3RvcnkgPSBBYnN0cmFjdFR3aU1MUXVlc3Rpb25GYWN0b3J5LmdldEluc3RhbmNlKHJlcXVlc3QpOwoKICAgICAgICBUd2lNTFF1ZXN0aW9uIHR3aU1MUXVlc3Rpb24gPSBxdWVzdGlvbi5tYXAoKFF1ZXN0aW9uIHEpIC0+IGZhY3RvcnkuYnVpbGQoc3VydmV5SWQsIHEpKQogICAgICAgICAgICAgICAgLm9yRWxzZVRocm93KCgpICAtPiBuZXcgUnVudGltZUV4Y2VwdGlvbihTdHJpbmcuZm9ybWF0KCJTdXJ2ZXkvcXVlc3Rpb24gJXMvJXMgbm90IGZvdW5kIiwKICAgICAgICAgICAgICAgICAgICAgICAgc3VydmV5SWQsIHF1ZXN0aW9uSWQpKSk7CgogICAgICAgIEh0dHBTZXNzaW9uIHNlc3Npb24gPSByZXF1ZXN0LmdldFNlc3Npb24odHJ1ZSk7CiAgICAgICAgc2Vzc2lvbi5zZXRBdHRyaWJ1dGUoImxhc3RTdXJ2ZXkiLCBzdXJ2ZXlJZCk7CiAgICAgICAgc2Vzc2lvbi5zZXRBdHRyaWJ1dGUoImxhc3RRdWVzdGlvbiIsIHF1ZXN0aW9uLmdldCgpLmdldElkKCkpOwoKICAgICAgICBTdHJpbmcgeG1sID0gdHdpTUxRdWVzdGlvbi50b0VzY2FwZWRYTUwoKTsKCiAgICAgICAgcmVzcG9uc2VXcml0ZXIud3JpdGVJbihyZXNwb25zZSwgeG1sKTsKICAgIH0KCn0K</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><a href="https://github.com/TwilioDevEd/automated-survey-spring" target="_blank" class="explorer-get-code"> <i class="fa fa-lg fa-github-square"> </i>View Code on GitHub</a></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>