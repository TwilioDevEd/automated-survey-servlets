<!DOCTYPE html><html><head><title>Automated Surveys using Servlets</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="Automated Surveys using Servlets"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">Automated Surveys using Servlets</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Learn to implement automated surveys in your Servlet web app with Twilio.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="Automated Surveys Servlet" class="chapter"><div data-tile="What Are We Building?" data-file="src/main/java/com/twilio/automatedsurvey/servlets/QuestionServlet.java" class="step"><h2 id="automated-survey">Automated Survey</h2>
<p>Have you ever wondered how to create an automated survey that can be answered over phone or SMS?</p>
<p>This tutorial will show how to do it using Twilio API.</p>
<h4 id="here-s-how-it-works-at-a-high-level">Here&#39;s how it works at a high level</h4>
<p><img src="//s3.amazonaws.com/howtodocs/automated-survey.png" alt="Automated Survey Diagram"></p>
<ol>
<li><p>The end user calls or sends an SMS to the survey phone number.</p>
</li>
<li><p>Twilio gets the call or text and makes an HTTP request to your application asking for instructions on how to respond.</p>
</li>
<li><p>Your web application instructs Twilio (using <a href="//www.twilio.com/docs/api/twiml">TwiML</a>)
to <a href="//www.twilio.com/docs/api/twiml/gather"><code>Gather</code></a> or
<a href="//www.twilio.com/docs/api/twiml/record"><code>Record</code></a> the user input over the phone,
and prompt for text input with <a href="//www.twilio.com/docs/api/twiml/sms/message"><code>Message</code></a>
if you are using SMS.</p>
</li>
<li><p>After each question, Twilio makes another request to your server with the user&#39;s input, which your application stores on its database.</p>
</li>
<li><p>After storing the answer, our server will instruct Twilio to <a href="//www.twilio.com/docs/api/twiml/redirect"><code>Redirect</code></a>
the user to the next question or finish the survey.</p>
</li>
</ol>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/docs/java/install">Getting started with Twilio Java</a></li>
<li><a href="//www.twilio.com/docs/api/twiml">TwiML: the Twilio Markup Language</a>.</li>
</ul>
</div><div data-tile="Create a Survey" data-file="src/main/java/com/twilio/automatedsurvey/servlets/SurveyServlet.java" data-highlight="55, 91-94" class="step"><h2 id="creating-a-survey">Creating a Survey</h2>
<p>In order to perform automated surveys we first need to set up the
questions. For your convenience, the application&#39;s
repository already includes one survey. If the database is configured correctly
every time that the app receives a request for a survey, it will
create a new survey registration.</p>
<p>You can modify the questions from the survey by editing the
<a href="//github.com/TwilioDevEd/automated-survey-servlets/blob/master/src/main/resources/survey.json">survey.json</a>
file located in the root of the repository and re-running the app.</p>
<p>We want users to take our survey, so next we will implement
the handler for SMS and calls.</p>
</div><div data-tile="The Interview Loop" data-file="src/main/java/com/twilio/automatedsurvey/servlets/SurveyServlet.java" data-highlight="45-88" class="step"><h2 id="the-interview-loop">The Interview Loop</h2>
<p>It is helpful to visualize your interaction with a user during a survey as a loop.
The chart below shows how that interaction will be handled. (click to enlarge):</p>
<p><img src="//s3.amazonaws.com/howtodocs/flowchart.png" alt="Survey Flow Chart"></p>
<p>The user can answer your survey&#39;s questions over the phone using either their phone&#39;s keypad or by voice input.
After each interaction, Twilio will make an HTTP request to your web application with either the string of
keys the user pressed or a URL to a recording of their voice input.</p>
<p>For SMS surveys the user will answer questions just by replying
with another SMS to your Twilio number where we got the question from.</p>
<p>It&#39;s up to the application to process, store and respond to the user&#39;s input.</p>
<p>Let&#39;s dive into this flow to see how it actually works.</p>
</div><div data-file="src/main/java/com/twilio/automatedsurvey/servlets/SurveyServlet.java" data-title="Configuring a Twilio Number" data-highlight="45-88" class="step"><h2 id="configuring-a-twilio-number">Configuring a Twilio Number</h2>
<p>To initiate the interview process, we need to configure one of our <a href="//www.twilio.com/user/account/phone-numbers/incoming">Twilio numbers</a>
to send our web application an HTTP request when we get an incoming call or text.</p>
<p><a href="//www.twilio.com/user/account/phone-numbers/incoming">Click on one of your numbers</a> and configure Voice and Message URLs to point to route
<code>/survey</code> using HTTP GET.</p>
<p><img src="//s3.amazonaws.com/howtodocs/number-config.png" alt="Configuring a Twilio Number"></p>
</div><div data-file="src/main/java/com/twilio/automatedsurvey/servlets/SurveyServlet.java" data-title="Responding To A Twilio Request" data-highlight="49, 71-82" class="step"><h2 id="responding-to-a-twilio-request">Responding to a Twilio Request</h2>
<p>Right after receiving a call or an SMS, Twilio will send a request to the URL specified on
the number&#39;s configuration.</p>
<p>The endpoint will then process the request. In case the request is not an answer from a previous question
the application will build and return a welcome message to the user. For phone users, the built
message will contain a <code>Say</code> verb with the message or a <code>Message</code> Verb for SMS.</p>
<p>It will also include a <code>Redirect</code> verb to the question&#39;s endpoint to continue with the survey flow.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/platform/webhooks">Twilio webhooks</a></li>
<li><a href="//www.twilio.com/docs/api/twiml/your_response">TwiML Voice: Your Response</a></li>
<li><a href="//www.twilio.com/docs/api/twiml/sms/your_response">TwiML SMS: Your Response</a></li>
<li><a href="//www.twilio.com/docs/api/twiml/say">TwiML Voice: &lt;Say&gt;</a></li>
<li><a href="//www.twilio.com/docs/api/twiml/sms/message">TwiML SMS: &lt;Message&gt;</a></li>
<li><a href="//www.twilio.com/docs/api/twiml/redirect">TwiML Voice: &lt;Redirect&gt;</a></li>
<li><a href="//www.twilio.com/docs/api/twiml/sms/redirect">TwiML SMS: &lt;Redirect&gt;</a></li>
</ul>
</div><div data-file="src/main/java/com/twilio/automatedsurvey/servlets/QuestionServlet.java" data-highlight="36-67" class="step"><h2 id="question-controller">Question Controller</h2>
<p>This endpoint will return the <code>Question</code> specified on the request. If no request is specified, It will return the
Survey&#39;s first question.</p>
<p>Each type of question and interaction (Call/SMS) will produce different instructions on how to proceed.
For instance we can record voice or gather a key press during a call, but we can&#39;t do the same for text messages.</p>
<p><code>AbstractTwiMLQuestionFactory.getInstance</code> solves that problem. It will return a different type of factory that will know
how to build responses depending on wether it&#39;s a SMS or a Call originated request.</p>
<p>When the user is interacting over SMS we don&#39;t have something like an ongoing call session with a well defined state.
It becomes harder to know if an SMS is answering question 2 or 20, since all requests will be fired to <code>/survey</code> main endpoint.</p>
<p>To solve that, we&#39;re storing in the HTTP session the ids of Survey and Question that are being returned to be reused on later
SMS requests.</p>
<p>Let&#39;s see how the response is built.</p>
</div><div data-file="src/main/java/com/twilio/automatedsurvey/servlets/TelephoneTwiMLQuestionFactory.java" data-highlight="32-60" class="step"><h2 id="building-our-twiml-verbs">Building Our TwiML Verbs</h2>
<p>If the question is of &quot;numeric&quot; or &quot;yes-no&quot; kind then we use the
<a href="//www.twilio.com/docs/api/twiml/gather"><code>&lt;Gather&gt;</code></a>
verb. However, if we expect the user to record an answer we use the
<a href="//www.twilio.com/docs/api/twiml/record"><code>&lt;Record&gt;</code></a>
verb. Both verbs take an <code>action</code> attribute and a <code>method</code>
attribute.</p>
<p>Twilio will use both attributes to define our response&#39;s endpoint that will be used as callback. That endpoint
will be responsible to receive and store the caller&#39;s answer.</p>
<p>During the Record verb creation, we also ask for a <a href="//www.twilio.com/docs/api/rest/transcription">Transcription</a>.
Twilio will process the record and extract useful text, making a request to our response endpoint when transcription is done.</p>
<h2 id="now-let-s-see-what-to-do-with-the-response-">Now let&#39;s see what to do with the response.</h2>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/docs/api/twiml/gather">TwiML Voice: &lt;Gather&gt;</a></li>
<li><a href="//www.twilio.com/docs/api/twiml/record">TwiML Voice: &lt;Record&gt;</a></li>
</ul>
</div><div data-file="src/main/java/com/twilio/automatedsurvey/survey/Survey.java" data-highlight="61-77" class="step"><h2 id="handling-responses-">Handling responses.</h2>
<p>After the user has finished speaking and pressing keys, Twilio just sends a request telling what
happened and asking for further instructions.</p>
<p>On <code>Survey.answerCall</code> and <code>Survey.answerSMS</code> we extract from a Map containing the request parameters the 
information needed to answer the question. </p>
<p>Recovered parameters vary according to what we asked on the questions, they can be:</p>
<ul>
<li><code>Body</code> contains the text message from answer over SMS.</li>
<li><code>Digits</code> contains the keys pressed for a numeric question.</li>
<li><code>RecordingUrl</code> contains the URL for listening a recorded message.</li>
<li><code>TranscriptionText</code> contains the result of a recording&#39;s transcription.</li>
</ul>
<p>After answering a question, the <code>SurveyController</code> redirects to our <code>QuestionServlet</code>, which will
ask the next question on the loop.</p>
<p>Now, let&#39;s see how to visualize the results.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/docs/api/twiml/your_response">TwiML Voice: Your Response</a></li>
<li><a href="//www.twilio.com/docs/api/twiml/sms/your_response">TwiML SMS: Your Response</a></li>
</ul>
</div><div data-file="src/main/java/com/twilio/automatedsurvey/servlets/IndexServlet.java" data-highlight="25-30" class="step"><h2 id="displaying-the-survey-s-results">Displaying the Survey&#39;s Results</h2>
<p>For this route we simply query the database using a JPA query
and then display the information within JSP page. We display a list
of surveys with their respective questions and answers.</p>
<p>You can access this page in the applications root route <code>/</code>.</p>
</div><div class="step"><h2 id="where-to-next-">Where to next?</h2>
<p>That&#39;s it!</p>
<p>If you have configured one of your Twilio
numbers to the application built in this tutorial you should be
able to take the survey and see the results under the root route of
the application. We hope you found this sample application
useful.  If you&#39;re a Java developer working with Twilio, you
might enjoy these other tutorials:</p>
<h3 id="-sms-and-mms-notifications-www-twilio-com-docs-tutorials-walkthrough-server-notifications-java-servlets-"><a href="//www.twilio.com/docs/tutorials/walkthrough/server-notifications/java/servlets">SMS and MMS Notifications</a></h3>
<p>Never miss another server outage. Learn how to build a server notification system that will alert
all administrators via SMS when a server outage occurs.</p>
<h3 id="-click-to-call-www-twilio-com-docs-tutorials-walkthrough-click-to-call-java-servlets-"><a href="//www.twilio.com/docs/tutorials/walkthrough/click-to-call/java/servlets">Click to Call</a></h3>
<p>Click-to-call enables your company to convert web traffic into phone calls with the click of a button.</p>
<h3 id="did-this-help-">Did this help?</h3>
<p>Thanks for checking this tutorial out! If you have any feedback to share with us,
we&#39;d love to hear it.<a href="//www.twilio.com/help/contact">Contact support</a> to let us know what you think.</p>
</div></div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="src/main/java/com/twilio/automatedsurvey/servlets/QuestionServlet.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLmF1dG9tYXRlZHN1cnZleS5zZXJ2bGV0czsKCmltcG9ydCBjb20uZ29vZ2xlLmluamVjdC5JbmplY3Q7CmltcG9ydCBjb20uZ29vZ2xlLmluamVjdC5TaW5nbGV0b247CmltcG9ydCBjb20udHdpbGlvLmF1dG9tYXRlZHN1cnZleS5zZXJ2bGV0cy50d2ltbHF1ZXN0aW9ucy5BYnN0cmFjdFR3aU1MUXVlc3Rpb25GYWN0b3J5OwppbXBvcnQgY29tLnR3aWxpby5hdXRvbWF0ZWRzdXJ2ZXkuc3VydmV5LlF1ZXN0aW9uOwppbXBvcnQgY29tLnR3aWxpby5hdXRvbWF0ZWRzdXJ2ZXkuc3VydmV5LlN1cnZleTsKaW1wb3J0IGNvbS50d2lsaW8uYXV0b21hdGVkc3VydmV5LnN1cnZleS5TdXJ2ZXlSZXBvc2l0b3J5OwppbXBvcnQgY29tLnR3aWxpby50d2ltbC5Ud2lNTDsKaW1wb3J0IGNvbS50d2lsaW8udHdpbWwuVHdpTUxFeGNlcHRpb247CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgppbXBvcnQgamF2YXguc2VydmxldC5odHRwLkh0dHBTZXJ2bGV0OwppbXBvcnQgamF2YXguc2VydmxldC5odHRwLkh0dHBTZXJ2bGV0UmVxdWVzdDsKaW1wb3J0IGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2VydmxldFJlc3BvbnNlOwppbXBvcnQgamF2YXguc2VydmxldC5odHRwLkh0dHBTZXNzaW9uOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5PcHRpb25hbDsKCkBTaW5nbGV0b24KcHVibGljIGNsYXNzIFF1ZXN0aW9uU2VydmxldCBleHRlbmRzIEh0dHBTZXJ2bGV0IHsKCiAgICBwcml2YXRlIHN0YXRpYyBMb2dnZXIgTE9HR0VSID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoUXVlc3Rpb25TZXJ2bGV0LmNsYXNzKTsKCiAgICBwcml2YXRlIFN1cnZleVJlcG9zaXRvcnkgc3VydmV5UmVwb3NpdG9yeTsKICAgIHByaXZhdGUgUmVzcG9uc2VXcml0ZXIgcmVzcG9uc2VXcml0ZXI7CgogICAgQEluamVjdAogICAgcHVibGljIFF1ZXN0aW9uU2VydmxldChTdXJ2ZXlSZXBvc2l0b3J5IHN1cnZleVJlcG9zaXRvcnksIFJlc3BvbnNlV3JpdGVyIHJlc3BvbnNlV3JpdGVyKSB7CiAgICAgICAgdGhpcy5zdXJ2ZXlSZXBvc2l0b3J5ID0gc3VydmV5UmVwb3NpdG9yeTsKICAgICAgICB0aGlzLnJlc3BvbnNlV3JpdGVyID0gcmVzcG9uc2VXcml0ZXI7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBkb0dldChIdHRwU2VydmxldFJlcXVlc3QgcmVxdWVzdCwgSHR0cFNlcnZsZXRSZXNwb25zZSByZXNwb25zZSkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBMb25nIHN1cnZleUlkID0gTG9uZy5wYXJzZUxvbmcocmVxdWVzdC5nZXRQYXJhbWV0ZXIoInN1cnZleSIpKTsKICAgICAgICAgICAgU3RyaW5nIHF1ZXN0aW9uSWQgPSByZXF1ZXN0LmdldFBhcmFtZXRlcigicXVlc3Rpb24iKTsKCgogICAgICAgICAgICBPcHRpb25hbDxTdXJ2ZXk+IHN1cnZleSA9IHN1cnZleVJlcG9zaXRvcnkuZmluZChzdXJ2ZXlJZCk7CiAgICAgICAgICAgIE9wdGlvbmFsPFF1ZXN0aW9uPiBxdWVzdGlvbjsKCiAgICAgICAgICAgIGlmIChxdWVzdGlvbklkID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHF1ZXN0aW9uID0gc3VydmV5LmZsYXRNYXAoKFN1cnZleSBzKSAtPiBzLmdldEZpcnN0UXVlc3Rpb24oKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBMb25nIHBhcnNlZFF1ZXN0aW9uSWQgPSBMb25nLnBhcnNlTG9uZyhxdWVzdGlvbklkKTsKICAgICAgICAgICAgICAgIHF1ZXN0aW9uID0gc3VydmV5LmZsYXRNYXAoKFN1cnZleSBzKSAtPiBzLnF1ZXN0aW9uQnlJZChwYXJzZWRRdWVzdGlvbklkKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEFic3RyYWN0VHdpTUxRdWVzdGlvbkZhY3RvcnkgZmFjdG9yeSA9IEFic3RyYWN0VHdpTUxRdWVzdGlvbkZhY3RvcnkuZ2V0SW5zdGFuY2UocmVxdWVzdCk7CgogICAgICAgICAgICBUd2lNTCB0d2lNTFJlc3BvbnNlID0gcXVlc3Rpb24ubWFwKChRdWVzdGlvbiBxKSAtPiBmYWN0b3J5LmJ1aWxkKHN1cnZleUlkLCBxKSkKICAgICAgICAgICAgICAgICAgICAub3JFbHNlVGhyb3coKCkgLT4gbmV3IFJ1bnRpbWVFeGNlcHRpb24oU3RyaW5nLmZvcm1hdCgiU3VydmV5L3F1ZXN0aW9uICVzLyVzIG5vdCBmb3VuZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdXJ2ZXlJZCwgcXVlc3Rpb25JZCkpKTsKCiAgICAgICAgICAgIEh0dHBTZXNzaW9uIHNlc3Npb24gPSByZXF1ZXN0LmdldFNlc3Npb24odHJ1ZSk7CiAgICAgICAgICAgIHNlc3Npb24uc2V0QXR0cmlidXRlKCJsYXN0U3VydmV5Iiwgc3VydmV5SWQpOwogICAgICAgICAgICBzZXNzaW9uLnNldEF0dHJpYnV0ZSgibGFzdFF1ZXN0aW9uIiwgcXVlc3Rpb24uZ2V0KCkuZ2V0SWQoKSk7CiAgICAgICAgICAgIFN0cmluZyB0b1htbCA9IHR3aU1MUmVzcG9uc2UudG9YbWwoKTsKCiAgICAgICAgICAgIExPR0dFUi5pbmZvKCJyZXNwb25zZToge30iLCB0b1htbCk7CiAgICAgICAgICAgIHJlc3BvbnNlV3JpdGVyLndyaXRlSW4ocmVzcG9uc2UsIHRvWG1sKTsKICAgICAgICB9IGNhdGNoIChUd2lNTEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7CiAgICAgICAgfQogICAgfQoKfQo=</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/automatedsurvey/servlets/SurveyServlet.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLmF1dG9tYXRlZHN1cnZleS5zZXJ2bGV0czsKCmltcG9ydCBjb20uZ29vZ2xlLmluamVjdC5JbmplY3Q7CmltcG9ydCBjb20uZ29vZ2xlLmluamVjdC5wZXJzaXN0LlRyYW5zYWN0aW9uYWw7CmltcG9ydCBjb20udHdpbGlvLmF1dG9tYXRlZHN1cnZleS5zdXJ2ZXkuUXVlc3Rpb247CmltcG9ydCBjb20udHdpbGlvLmF1dG9tYXRlZHN1cnZleS5zdXJ2ZXkuU3VydmV5OwppbXBvcnQgY29tLnR3aWxpby5hdXRvbWF0ZWRzdXJ2ZXkuc3VydmV5LlN1cnZleVJlcG9zaXRvcnk7CmltcG9ydCBjb20udHdpbGlvLmF1dG9tYXRlZHN1cnZleS5zdXJ2ZXkubG9hZGVyLlN1cnZleUxvYWRlcjsKaW1wb3J0IGNvbS50d2lsaW8udHdpbWwuQm9keTsKaW1wb3J0IGNvbS50d2lsaW8udHdpbWwuTWVzc2FnZTsKaW1wb3J0IGNvbS50d2lsaW8udHdpbWwuTWVzc2FnaW5nUmVzcG9uc2U7CmltcG9ydCBjb20udHdpbGlvLnR3aW1sLk1ldGhvZDsKaW1wb3J0IGNvbS50d2lsaW8udHdpbWwuUmVkaXJlY3Q7CmltcG9ydCBjb20udHdpbGlvLnR3aW1sLlNheTsKaW1wb3J0IGNvbS50d2lsaW8udHdpbWwuVHdpTUw7CmltcG9ydCBjb20udHdpbGlvLnR3aW1sLlR3aU1MRXhjZXB0aW9uOwppbXBvcnQgY29tLnR3aWxpby50d2ltbC5Wb2ljZVJlc3BvbnNlOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IGphdmF4LmluamVjdC5TaW5nbGV0b247CmltcG9ydCBqYXZheC5zZXJ2bGV0Lmh0dHAuSHR0cFNlcnZsZXQ7CmltcG9ydCBqYXZheC5zZXJ2bGV0Lmh0dHAuSHR0cFNlcnZsZXRSZXF1ZXN0OwppbXBvcnQgamF2YXguc2VydmxldC5odHRwLkh0dHBTZXJ2bGV0UmVzcG9uc2U7CmltcG9ydCBqYXZheC5zZXJ2bGV0Lmh0dHAuSHR0cFNlc3Npb247CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLk9wdGlvbmFsOwoKQFNpbmdsZXRvbgpwdWJsaWMgY2xhc3MgU3VydmV5U2VydmxldCBleHRlbmRzIEh0dHBTZXJ2bGV0IHsKCgogICAgcHJpdmF0ZSBzdGF0aWMgTG9nZ2VyIExPR0dFUiA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKFN1cnZleVNlcnZsZXQuY2xhc3MpOwoKICAgIHByaXZhdGUgU3VydmV5UmVwb3NpdG9yeSBzdXJ2ZXlSZXBvOwogICAgcHJpdmF0ZSBSZXNwb25zZVdyaXRlciByZXNwb25zZVdyaXRlcjsKCiAgICBASW5qZWN0CiAgICBwdWJsaWMgU3VydmV5U2VydmxldChTdXJ2ZXlSZXBvc2l0b3J5IHN1cnZleVJlcG8sIFJlc3BvbnNlV3JpdGVyIHJlc3BvbnNlV3JpdGVyKSB7CiAgICAgICAgdGhpcy5zdXJ2ZXlSZXBvID0gc3VydmV5UmVwbzsKICAgICAgICB0aGlzLnJlc3BvbnNlV3JpdGVyID0gcmVzcG9uc2VXcml0ZXI7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBkb0dldChIdHRwU2VydmxldFJlcXVlc3QgcmVxdWVzdCwgSHR0cFNlcnZsZXRSZXNwb25zZSByZXNwb25zZSkgewogICAgICAgIEh0dHBTZXNzaW9uIHNlc3Npb24gPSByZXF1ZXN0LmdldFNlc3Npb24odHJ1ZSk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChpc1Ntc0Fuc3dlcihyZXF1ZXN0KSkgewogICAgICAgICAgICAgICAgU3RyaW5nIHN1cnZleSA9IHNlc3Npb24uZ2V0QXR0cmlidXRlKCJsYXN0U3VydmV5IikudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgIFN0cmluZyBsYXN0UXVlc3Rpb24gPSBzZXNzaW9uLmdldEF0dHJpYnV0ZSgibGFzdFF1ZXN0aW9uIikudG9TdHJpbmcoKTsKCiAgICAgICAgICAgICAgICByZWRpcmVjdFRvQW5zd2VyRW5kcG9pbnQocmVzcG9uc2UsIHN1cnZleSwgbGFzdFF1ZXN0aW9uKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIFN1cnZleSBuZXdTdXJ2ZXkgPSBjcmVhdGVTdXJ2ZXlJbnN0YW5jZSgpOwoKICAgICAgICAgICAgICAgIFN0cmluZyBtZXNzYWdlID0gU3RyaW5nLmZvcm1hdCgiV2VsY29tZSB0byB0aGUgJXMgc3VydmV5IiwgbmV3U3VydmV5LmdldFRpdGxlKCkpOwogICAgICAgICAgICAgICAgaWYgKGlzU21zKHJlcXVlc3QpKSB7CiAgICAgICAgICAgICAgICAgICAgTWVzc2FnaW5nUmVzcG9uc2UgbWVzc2FnaW5nUmVzcG9uc2UgPSBuZXcgTWVzc2FnaW5nUmVzcG9uc2UuQnVpbGRlcigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWVzc2FnZShuZXcgTWVzc2FnZS5CdWlsZGVyKCkuYm9keShuZXcgQm9keShtZXNzYWdlKSkuYnVpbGQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZWRpcmVjdChuZXcgUmVkaXJlY3QuQnVpbGRlcigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC51cmwoU3RyaW5nLmZvcm1hdCgicXVlc3Rpb24/c3VydmV5PSVzIiwgbmV3U3VydmV5LmdldElkKCkpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWV0aG9kKE1ldGhvZC5HRVQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5idWlsZCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYnVpbGQoKTsKICAgICAgICAgICAgICAgICAgICBTdHJpbmcgdG9YbWwgPSBtZXNzYWdpbmdSZXNwb25zZS50b1htbCgpOwogICAgICAgICAgICAgICAgICAgIExPR0dFUi5pbmZvKCJyZXNwb25zZToge30iLCB0b1htbCk7CiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VXcml0ZXIud3JpdGVJbihyZXNwb25zZSwgdG9YbWwpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBWb2ljZVJlc3BvbnNlIHZvaWNlUmVzcG9uc2UgPSBuZXcgVm9pY2VSZXNwb25zZS5CdWlsZGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zYXkobmV3IFNheS5CdWlsZGVyKG1lc3NhZ2UpLmJ1aWxkKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVkaXJlY3QobmV3IFJlZGlyZWN0LkJ1aWxkZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudXJsKFN0cmluZy5mb3JtYXQoInF1ZXN0aW9uP3N1cnZleT0lcyIsIG5ld1N1cnZleS5nZXRJZCgpKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1ldGhvZChNZXRob2QuR0VUKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYnVpbGQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmJ1aWxkKCk7CgogICAgICAgICAgICAgICAgICAgIFN0cmluZyB0b1htbCA9IHZvaWNlUmVzcG9uc2UudG9YbWwoKTsKICAgICAgICAgICAgICAgICAgICBMT0dHRVIuaW5mbygicmVzcG9uc2U6IHt9IiwgdG9YbWwpOwogICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlV3JpdGVyLndyaXRlSW4ocmVzcG9uc2UsIHRvWG1sKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7CiAgICAgICAgfQogICAgfQoKICAgIEBUcmFuc2FjdGlvbmFsCiAgICBwcml2YXRlIFN1cnZleSBjcmVhdGVTdXJ2ZXlJbnN0YW5jZSgpIHsKICAgICAgICBTdXJ2ZXlMb2FkZXIgbG9hZGVyID0gbmV3IFN1cnZleUxvYWRlcigic3VydmV5Lmpzb24iKTsKICAgICAgICByZXR1cm4gc3VydmV5UmVwby5hZGQobG9hZGVyLmxvYWQoKSk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHJlZGlyZWN0VG9BbnN3ZXJFbmRwb2ludChIdHRwU2VydmxldFJlc3BvbnNlIHJlc3BvbnNlLCBTdHJpbmcgc3VydmV5LCBTdHJpbmcgbGFzdFF1ZXN0aW9uKSB0aHJvd3MgVHdpTUxFeGNlcHRpb24sIElPRXhjZXB0aW9uIHsKICAgICAgICBNZXNzYWdpbmdSZXNwb25zZSBtZXNzYWdpbmdSZXNwb25zZSA9IG5ldyBNZXNzYWdpbmdSZXNwb25zZS5CdWlsZGVyKCkKICAgICAgICAgICAgICAgIC5yZWRpcmVjdChuZXcgUmVkaXJlY3QuQnVpbGRlcigpCiAgICAgICAgICAgICAgICAgICAgICAgIC51cmwoU3RyaW5nLmZvcm1hdCgic3VydmV5P3N1cnZleT0lcyZxdWVzdGlvbj0lcyIsIHN1cnZleSwgbGFzdFF1ZXN0aW9uKSkKICAgICAgICAgICAgICAgICAgICAgICAgLm1ldGhvZChNZXRob2QuUE9TVCkKICAgICAgICAgICAgICAgICAgICAgICAgLmJ1aWxkKCkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIC5idWlsZCgpOwogICAgICAgIHRoaXMucmVzcG9uc2VXcml0ZXIud3JpdGVJbihyZXNwb25zZSwgbWVzc2FnaW5nUmVzcG9uc2UudG9YbWwoKSk7CiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIGlzU21zQW5zd2VyKEh0dHBTZXJ2bGV0UmVxdWVzdCByZXF1ZXN0KSB7CiAgICAgICAgSHR0cFNlc3Npb24gc2Vzc2lvbiA9IHJlcXVlc3QuZ2V0U2Vzc2lvbih0cnVlKTsKICAgICAgICByZXR1cm4gc2Vzc2lvbi5nZXRBdHRyaWJ1dGUoImxhc3RTdXJ2ZXkiKSAhPSBudWxsOwogICAgfQoKICAgIHByaXZhdGUgYm9vbGVhbiBpc1NtcyhIdHRwU2VydmxldFJlcXVlc3QgcmVxdWVzdCkgewogICAgICAgIHJldHVybiByZXF1ZXN0LmdldFBhcmFtZXRlcigiTWVzc2FnZVNpZCIpICE9IG51bGw7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBAVHJhbnNhY3Rpb25hbAogICAgcHVibGljIHZvaWQgZG9Qb3N0KEh0dHBTZXJ2bGV0UmVxdWVzdCByZXF1ZXN0LCBIdHRwU2VydmxldFJlc3BvbnNlIHJlc3BvbnNlKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIExvbmcgc3VydmV5SWQgPSBMb25nLnBhcnNlTG9uZyhyZXF1ZXN0LmdldFBhcmFtZXRlcigic3VydmV5IikpOwoKICAgICAgICAgICAgU3VydmV5IHN1cnZleSA9IHN1cnZleVJlcG8uZmluZChzdXJ2ZXlJZCkub3JFbHNlVGhyb3coKCkgLT4gbmV3IFJ1bnRpbWVFeGNlcHRpb24oIlN1cnZleSB3YXMgbm90IGZvdW5kIikpOwoKICAgICAgICAgICAgUXVlc3Rpb24gYW5zd2VyZWRRdWVzdGlvbiA9IGlzU21zKHJlcXVlc3QpID8gc3VydmV5LmFuc3dlclNNUyhyZXF1ZXN0LmdldFBhcmFtZXRlck1hcCgpKSA6CiAgICAgICAgICAgICAgICAgICAgc3VydmV5LmFuc3dlckNhbGwocmVxdWVzdC5nZXRQYXJhbWV0ZXJNYXAoKSk7CgogICAgICAgICAgICBzdXJ2ZXlSZXBvLnVwZGF0ZShzdXJ2ZXkpOwoKICAgICAgICAgICAgT3B0aW9uYWw8UXVlc3Rpb24+IG5leHRRdWVzdGlvbiA9IHN1cnZleS5nZXROZXh0UXVlc3Rpb24oYW5zd2VyZWRRdWVzdGlvbik7CgogICAgICAgICAgICBUd2lNTCB0d2lNTFJlc3BvbnNlID0gbmV4dFF1ZXN0aW9uLm1hcCgoUXVlc3Rpb24gcSkgLT4gYnVpbGRSZWRpcmVjdFR3aU1MTWVzc2FnZShzdXJ2ZXlJZCwgcSwgcmVxdWVzdCkpCiAgICAgICAgICAgICAgICAgICAgLm9yRWxzZShidWlsZFRoYW5rWW91VHdpTUxSZXNwb25zZShzdXJ2ZXkuZ2V0VGl0bGUoKSwgcmVxdWVzdCkpOwoKCiAgICAgICAgICAgIFN0cmluZyB0b1htbCA9IHR3aU1MUmVzcG9uc2UudG9YbWwoKTsKICAgICAgICAgICAgTE9HR0VSLmluZm8oInJlc3BvbnNlOiB7fSIsIHRvWG1sKTsKICAgICAgICAgICAgcmVzcG9uc2VXcml0ZXIud3JpdGVJbihyZXNwb25zZSwgdG9YbWwpOwogICAgICAgIH0gY2F0Y2ggKFR3aU1MRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24oZSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgVHdpTUwgYnVpbGRUaGFua1lvdVR3aU1MUmVzcG9uc2UoU3RyaW5nIHN1cnZleVRpdGxlLCBIdHRwU2VydmxldFJlcXVlc3QgcmVxdWVzdCkgewogICAgICAgIGZpbmFsIFN0cmluZyByZWFsTWVzc2FnZSA9IFN0cmluZy5mb3JtYXQoIlRoYW5rIHlvdSBmb3IgdGFraW5nIHRoZSAlcyBzdXJ2ZXkuIEdvb2QgYnllLiIsIHN1cnZleVRpdGxlKTsKICAgICAgICBpZiAoaXNTbXMocmVxdWVzdCkpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBNZXNzYWdpbmdSZXNwb25zZS5CdWlsZGVyKCkKICAgICAgICAgICAgICAgICAgICAubWVzc2FnZShuZXcgTWVzc2FnZS5CdWlsZGVyKCkuYm9keShuZXcgQm9keShyZWFsTWVzc2FnZSkpLmJ1aWxkKCkpCiAgICAgICAgICAgICAgICAgICAgLmJ1aWxkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWb2ljZVJlc3BvbnNlLkJ1aWxkZXIoKQogICAgICAgICAgICAgICAgICAgIC5zYXkobmV3IFNheS5CdWlsZGVyKHJlYWxNZXNzYWdlKS5idWlsZCgpKQogICAgICAgICAgICAgICAgICAgIC5idWlsZCgpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIFR3aU1MIGJ1aWxkUmVkaXJlY3RUd2lNTE1lc3NhZ2UoTG9uZyBzdXJ2ZXlJZCwgUXVlc3Rpb24gcSwgSHR0cFNlcnZsZXRSZXF1ZXN0IHJlcXVlc3QpIHsKICAgICAgICBmaW5hbCBTdHJpbmcgdXJsID0gU3RyaW5nLmZvcm1hdCgicXVlc3Rpb24/c3VydmV5PSVzJnF1ZXN0aW9uPSVzIiwgc3VydmV5SWQsIHEuZ2V0SWQoKSk7CiAgICAgICAgZmluYWwgUmVkaXJlY3QgcmVkaXJlY3QgPSBuZXcgUmVkaXJlY3QuQnVpbGRlcigpLnVybCh1cmwpLm1ldGhvZChNZXRob2QuR0VUKS5idWlsZCgpOwogICAgICAgIGlmIChpc1NtcyhyZXF1ZXN0KSkgewogICAgICAgICAgICByZXR1cm4gbmV3IE1lc3NhZ2luZ1Jlc3BvbnNlLkJ1aWxkZXIoKQogICAgICAgICAgICAgICAgICAgIC5yZWRpcmVjdChyZWRpcmVjdCkKICAgICAgICAgICAgICAgICAgICAuYnVpbGQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gbmV3IFZvaWNlUmVzcG9uc2UuQnVpbGRlcigpCiAgICAgICAgICAgICAgICAgICAgLnJlZGlyZWN0KHJlZGlyZWN0KQogICAgICAgICAgICAgICAgICAgIC5idWlsZCgpOwogICAgICAgIH0KICAgIH0KCgp9Cg==</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/automatedsurvey/servlets/TelephoneTwiMLQuestionFactory.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLmF1dG9tYXRlZHN1cnZleS5zZXJ2bGV0czsKCmltcG9ydCBjb20udHdpbGlvLmF1dG9tYXRlZHN1cnZleS5zZXJ2bGV0cy50d2ltbHF1ZXN0aW9ucy5BYnN0cmFjdFR3aU1MUXVlc3Rpb25GYWN0b3J5OwppbXBvcnQgY29tLnR3aWxpby5hdXRvbWF0ZWRzdXJ2ZXkuc3VydmV5LlF1ZXN0aW9uOwppbXBvcnQgY29tLnR3aWxpby50d2ltbC5HYXRoZXI7CmltcG9ydCBjb20udHdpbGlvLnR3aW1sLk1ldGhvZDsKaW1wb3J0IGNvbS50d2lsaW8udHdpbWwuUGF1c2U7CmltcG9ydCBjb20udHdpbGlvLnR3aW1sLlJlY29yZDsKaW1wb3J0IGNvbS50d2lsaW8udHdpbWwuU2F5OwppbXBvcnQgY29tLnR3aWxpby50d2ltbC5Wb2ljZVJlc3BvbnNlOwoKcHVibGljIGNsYXNzIFRlbGVwaG9uZVR3aU1MUXVlc3Rpb25GYWN0b3J5IGV4dGVuZHMgQWJzdHJhY3RUd2lNTFF1ZXN0aW9uRmFjdG9yeSB7CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgVm9pY2VSZXNwb25zZSBidWlsZChMb25nIHN1cnZleUlkLCBRdWVzdGlvbiBxdWVzdGlvbikgewogICAgICAgIHN3aXRjaCAocXVlc3Rpb24uZ2V0VHlwZSgpKXsKICAgICAgICAgICAgY2FzZSB2b2ljZToKICAgICAgICAgICAgICAgIHJldHVybiAgYnVpbGRWb2ljZU1lc3NhZ2Uoc3VydmV5SWQsIHF1ZXN0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAiUmVjb3JkIHlvdXIgYW5zd2VyIGFmdGVyIHRoZSBiZWVwIGFuZCBwcmVzcyB0aGUgcG91bmQga2V5IHdoZW4geW91IGFyZSBkb25lLiIpOwogICAgICAgICAgICBjYXNlIG51bWVyaWM6CiAgICAgICAgICAgICAgICByZXR1cm4gYnVpbGROdW1lcmljTWVzc2FnZShzdXJ2ZXlJZCwgcXVlc3Rpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICJGb3IgdGhlIG5leHQgcXVlc3Rpb24gc2VsZWN0IGEgbnVtYmVyIHdpdGggdGhlIGRpYWwgcGFkICIgKwogICAgICAgICAgICAgICAgICAgICAgICAiYW5kIHRoZW4gcHJlc3MgdGhlIHBvdW5kIGtleSIpOwogICAgICAgICAgICBjYXNlIHllc25vOgogICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkTnVtZXJpY01lc3NhZ2Uoc3VydmV5SWQsIHF1ZXN0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAiRm9yIHRoZSBuZXh0IHF1ZXN0aW9uLCBwcmVzcyAxIGZvciB5ZXMsIGFuZCAwIGZvciBuby4gVGhlbiBwcmVzcyB0aGUgcG91bmQga2V5LiIpOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24oIkludmFsaWQgcXVlc3Rpb24gdHlwZSIpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIFZvaWNlUmVzcG9uc2UgYnVpbGRWb2ljZU1lc3NhZ2UoTG9uZyBzdXJ2ZXlJZCwgUXVlc3Rpb24gcXVlc3Rpb24sIFN0cmluZyBtZXNzYWdlKSB7CiAgICAgICAgcmV0dXJuIG5ldyBWb2ljZVJlc3BvbnNlLkJ1aWxkZXIoKQogICAgICAgICAgICAgICAgLnNheShuZXcgU2F5LkJ1aWxkZXIobWVzc2FnZSkuYnVpbGQoKSkKICAgICAgICAgICAgICAgIC5wYXVzZShuZXcgUGF1c2UuQnVpbGRlcigpLmJ1aWxkKCkpCiAgICAgICAgICAgICAgICAuc2F5KG5ldyBTYXkuQnVpbGRlcihxdWVzdGlvbi5nZXRCb2R5KCkpLmJ1aWxkKCkpCiAgICAgICAgICAgICAgICAucmVjb3JkKG5ldyBSZWNvcmQuQnVpbGRlcigpCiAgICAgICAgICAgICAgICAgICAgICAgIC50cmFuc2NyaWJlKHRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgIC50cmFuc2NyaWJlQ2FsbGJhY2soInN1cnZleT9zdXJ2ZXk9Iisgc3VydmV5SWQgKyImYW1wO3F1ZXN0aW9uPSIrcXVlc3Rpb24uZ2V0SWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgLmFjdGlvbigic3VydmV5P3N1cnZleT0iKyBzdXJ2ZXlJZCArIiZhbXA7cXVlc3Rpb249IitxdWVzdGlvbi5nZXRJZCgpKQogICAgICAgICAgICAgICAgICAgICAgICAubWV0aG9kKE1ldGhvZC5QT1NUKQogICAgICAgICAgICAgICAgICAgICAgICAubWF4TGVuZ3RoKDYpCiAgICAgICAgICAgICAgICAgICAgICAgIC5idWlsZCgpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAuYnVpbGQoKTsKICAgIH0KCiAgICBwcml2YXRlIFZvaWNlUmVzcG9uc2UgYnVpbGROdW1lcmljTWVzc2FnZShMb25nIHN1cnZleUlkLCBRdWVzdGlvbiBxdWVzdGlvbiwgU3RyaW5nIG1lc3NhZ2UpIHsKICAgICAgICByZXR1cm4gbmV3IFZvaWNlUmVzcG9uc2UuQnVpbGRlcigpCiAgICAgICAgICAgICAgICAuc2F5KG5ldyBTYXkuQnVpbGRlcihtZXNzYWdlKS5idWlsZCgpKQogICAgICAgICAgICAgICAgLnBhdXNlKG5ldyBQYXVzZS5CdWlsZGVyKCkuYnVpbGQoKSkKICAgICAgICAgICAgICAgIC5zYXkobmV3IFNheS5CdWlsZGVyKHF1ZXN0aW9uLmdldEJvZHkoKSkuYnVpbGQoKSkKICAgICAgICAgICAgICAgIC5nYXRoZXIobmV3IEdhdGhlci5CdWlsZGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgLmFjdGlvbigic3VydmV5P3N1cnZleT0iICsgc3VydmV5SWQgKyAiJmFtcDtxdWVzdGlvbj0iICsgcXVlc3Rpb24uZ2V0SWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgLm1ldGhvZChNZXRob2QuUE9TVCkKICAgICAgICAgICAgICAgICAgICAgICAgLmZpbmlzaE9uS2V5KCIjIikKICAgICAgICAgICAgICAgICAgICAgICAgLmJ1aWxkKCkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIC5idWlsZCgpOwogICAgfQp9Cg==</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/automatedsurvey/survey/Survey.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLmF1dG9tYXRlZHN1cnZleS5zdXJ2ZXk7CgppbXBvcnQgY29tLmdvb2dsZS5pbmplY3QucGVyc2lzdC5UcmFuc2FjdGlvbmFsOwoKaW1wb3J0IGphdmF4LnBlcnNpc3RlbmNlLio7CmltcG9ydCBqYXZhLnV0aWwuKjsKaW1wb3J0IGphdmEudXRpbC5mdW5jdGlvbi5GdW5jdGlvbjsKaW1wb3J0IGphdmEudXRpbC5zdHJlYW0uQ29sbGVjdG9yczsKaW1wb3J0IGphdmEudXRpbC5zdHJlYW0uU3RyZWFtOwoKQEVudGl0eQpwdWJsaWMgY2xhc3MgU3VydmV5IHsKICAgIEBJZAogICAgQEdlbmVyYXRlZFZhbHVlCiAgICBwcml2YXRlIExvbmcgaWQ7CiAgICBwcml2YXRlIFN0cmluZyB0aXRsZTsKICAgIEBPbmVUb01hbnkoY2FzY2FkZSA9IENhc2NhZGVUeXBlLkFMTCwgZmV0Y2ggPSBGZXRjaFR5cGUuTEFaWSkKICAgIEBKb2luQ29sdW1uKG5hbWU9InN1cnZleV9pZCIpCiAgICBwcml2YXRlIFNldDxRdWVzdGlvbj4gcXVlc3Rpb25zOwoKICAgIHsKICAgICAgICBxdWVzdGlvbnMgPSBuZXcgSGFzaFNldDw+KCk7CiAgICB9CgogICAgcHJpdmF0ZSBTdXJ2ZXkoKSB7IC8qIG5lZWRlZCBieSB0aGUgT1JNICovIH0KCiAgICBwdWJsaWMgU3VydmV5KFN0cmluZyB0aXRsZSkgewogICAgICAgIHRoaXMobnVsbCwgdGl0bGUpOwogICAgfQoKICAgIHB1YmxpYyBTdXJ2ZXkoTG9uZyBpZCwgU3RyaW5nIHRpdGxlKSB7CiAgICAgICAgdGhpcy5pZCA9IGlkOwogICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldFRpdGxlKCkgewogICAgICAgIHJldHVybiB0aXRsZTsKICAgIH0KCiAgICBwdWJsaWMgTG9uZyBnZXRJZCgpIHsKICAgICAgICByZXR1cm4gaWQ7CiAgICB9CgogICAgcHVibGljIFNldDxRdWVzdGlvbj4gZ2V0UXVlc3Rpb25zKCkgewogICAgICAgIHJldHVybiBxdWVzdGlvbnM7CiAgICB9CgogICAgcHVibGljIE9wdGlvbmFsPFF1ZXN0aW9uPiBnZXRGaXJzdFF1ZXN0aW9uKCkgewogICAgICAgIHJldHVybiBnZXRTb3J0ZWRRdWVzdGlvbnMoKS5maW5kRmlyc3QoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhZGRRdWVzdGlvbihRdWVzdGlvbiBxdWVzdGlvbikgewogICAgICAgIHF1ZXN0aW9ucy5hZGQocXVlc3Rpb24pOwogICAgfQoKICAgIHByaXZhdGUgU3RyZWFtPFF1ZXN0aW9uPiBnZXRTb3J0ZWRRdWVzdGlvbnMoKSB7CiAgICAgICAgQ29tcGFyYXRvcjxRdWVzdGlvbj4gcXVlc3Rpb25JZENvbXBhcmF0b3IgPSAoZWxlbTEsIGVsZW0yKSAtPiBlbGVtMS5nZXRJZCgpLmNvbXBhcmVUbyhlbGVtMi5nZXRJZCgpKTsKICAgICAgICByZXR1cm4gcXVlc3Rpb25zLnN0cmVhbSgpLnNvcnRlZChxdWVzdGlvbklkQ29tcGFyYXRvcik7CiAgICB9CgogICAgQFRyYW5zYWN0aW9uYWwKICAgIHB1YmxpYyBRdWVzdGlvbiBhbnN3ZXJDYWxsKE1hcDxTdHJpbmcsIFN0cmluZ1tdPiBwYXJhbWV0ZXJzKSB7CiAgICAgICAgcmV0dXJuIGFuc3dlclVzaW5nKHBhcmFtZXRlcnMsIChRdWVzdGlvbiBxdWVzdGlvbikgLT4gewogICAgICAgICAgICBTdHJpbmcgYW5zd2VyS2V5ID0gcGFyYW1ldGVycy5jb250YWluc0tleSgiVHJhbnNjcmlwdGlvblRleHQiKSA/CiAgICAgICAgICAgICAgICAgICAgIlRyYW5zY3JpcHRpb25UZXh0IiA6IHF1ZXN0aW9uLmdldFR5cGUoKS5nZXRBbnN3ZXJLZXkoKTsKCiAgICAgICAgICAgIHF1ZXN0aW9uLnNldEFuc3dlcihwYXJhbWV0ZXJzLmdldChhbnN3ZXJLZXkpWzBdKTsKICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uOwogICAgICAgIH0pOwogICAgfQoKICAgIHB1YmxpYyBRdWVzdGlvbiBhbnN3ZXJTTVMoTWFwPFN0cmluZywgU3RyaW5nW10+IHBhcmFtZXRlcnMpIHsKICAgICAgICByZXR1cm4gYW5zd2VyVXNpbmcocGFyYW1ldGVycywgKFF1ZXN0aW9uIHEpIC0+IHsKICAgICAgICAgICAgcS5zZXRBbnN3ZXIocGFyYW1ldGVycy5nZXQoIkJvZHkiKVswXSk7CiAgICAgICAgICAgIHJldHVybiBxOwogICAgICAgIH0pOwogICAgfQoKICAgIHByaXZhdGUgUXVlc3Rpb24gYW5zd2VyVXNpbmcoTWFwPFN0cmluZywgU3RyaW5nW10+IHBhcmFtZXRlcnMsIEZ1bmN0aW9uPFF1ZXN0aW9uLCBRdWVzdGlvbj4gZXh0cmFjdEFuZEFwcGx5QW5zd2VyKSB7CiAgICAgICAgU3RyaW5nIHF1ZXN0aW9uSWQgPSBwYXJhbWV0ZXJzLmdldCgicXVlc3Rpb24iKVswXTsKCiAgICAgICAgT3B0aW9uYWw8UXVlc3Rpb24+IHF1ZXN0aW9uID0gcXVlc3Rpb25CeUlkKExvbmcucGFyc2VMb25nKHF1ZXN0aW9uSWQpKTsKCiAgICAgICAgcmV0dXJuIHF1ZXN0aW9uLm1hcChleHRyYWN0QW5kQXBwbHlBbnN3ZXIpCiAgICAgICAgICAgICAgICAub3JFbHNlVGhyb3coKCkgLT4gbmV3IFJ1bnRpbWVFeGNlcHRpb24oU3RyaW5nLmZvcm1hdCgiUXVlc3Rpb24gJXMgZnJvbSBTdXJ2ZXkgJXMgbm90IGZvdW5kIiwgaWQsIHF1ZXN0aW9uSWQpKSk7CiAgICB9CgogICAgcHVibGljIE9wdGlvbmFsPFF1ZXN0aW9uPiBxdWVzdGlvbkJ5SWQoTG9uZyBxdWVzdGlvbklkKSB7CiAgICAgICAgcmV0dXJuIHF1ZXN0aW9ucy5zdHJlYW0oKS5maWx0ZXIoKFF1ZXN0aW9uIHF1ZXN0aW9uKSAtPiBxdWVzdGlvbi5nZXRJZCgpLmVxdWFscyhxdWVzdGlvbklkKSkKICAgICAgICAgICAgICAgIC5maW5kRmlyc3QoKTsKICAgIH0KCiAgICBwdWJsaWMgT3B0aW9uYWw8UXVlc3Rpb24+IGdldE5leHRRdWVzdGlvbihRdWVzdGlvbiBwcmV2aW91c1F1ZXN0aW9uKSB7CiAgICAgICAgTGlzdDxRdWVzdGlvbj4gc29ydGVkUXVlc3Rpb25zID0gZ2V0U29ydGVkUXVlc3Rpb25zKCkuY29sbGVjdChDb2xsZWN0b3JzLnRvTGlzdCgpKTsKCiAgICAgICAgaW50IHByZXZpb3VzUXVlc3Rpb25JbmRleCA9IHNvcnRlZFF1ZXN0aW9ucy5pbmRleE9mKHByZXZpb3VzUXVlc3Rpb24pOwogICAgICAgIGludCBuZXh0UXVlc3Rpb25JbmRleCA9IHByZXZpb3VzUXVlc3Rpb25JbmRleCsxOwoKICAgICAgICBpZiAobmV4dFF1ZXN0aW9uSW5kZXggPj0gc29ydGVkUXVlc3Rpb25zLnNpemUoKSkgewogICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwuZW1wdHkoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gT3B0aW9uYWwub2Yoc29ydGVkUXVlc3Rpb25zLmdldChuZXh0UXVlc3Rpb25JbmRleCkpOwogICAgICAgIH0KICAgIH0KCn0K</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/automatedsurvey/servlets/IndexServlet.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLmF1dG9tYXRlZHN1cnZleS5zZXJ2bGV0czsKCmltcG9ydCBjb20uZ29vZ2xlLmluamVjdC5TaW5nbGV0b247CmltcG9ydCBjb20udHdpbGlvLmF1dG9tYXRlZHN1cnZleS5zdXJ2ZXkuU3VydmV5OwppbXBvcnQgY29tLnR3aWxpby5hdXRvbWF0ZWRzdXJ2ZXkuc3VydmV5LlN1cnZleVJlcG9zaXRvcnk7CgppbXBvcnQgamF2YXguaW5qZWN0LkluamVjdDsKaW1wb3J0IGphdmF4LnNlcnZsZXQuU2VydmxldEV4Y2VwdGlvbjsKaW1wb3J0IGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2VydmxldDsKaW1wb3J0IGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2VydmxldFJlcXVlc3Q7CmltcG9ydCBqYXZheC5zZXJ2bGV0Lmh0dHAuSHR0cFNlcnZsZXRSZXNwb25zZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKCkBTaW5nbGV0b24KcHVibGljIGNsYXNzIEluZGV4U2VydmxldCBleHRlbmRzIEh0dHBTZXJ2bGV0ewoKICAgIHByaXZhdGUgU3VydmV5UmVwb3NpdG9yeSByZXBvc2l0b3J5OwoKICAgIEBJbmplY3QKICAgIHB1YmxpYyBJbmRleFNlcnZsZXQoU3VydmV5UmVwb3NpdG9yeSByZXBvc2l0b3J5KSB7CiAgICAgICAgdGhpcy5yZXBvc2l0b3J5ID0gcmVwb3NpdG9yeTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGRvR2V0KEh0dHBTZXJ2bGV0UmVxdWVzdCByZXF1ZXN0LCBIdHRwU2VydmxldFJlc3BvbnNlIHJlc3BvbnNlKSB0aHJvd3MgU2VydmxldEV4Y2VwdGlvbiwgSU9FeGNlcHRpb24gewogICAgICAgIExpc3Q8U3VydmV5PiBzdXJ2ZXlzID0gcmVwb3NpdG9yeS5hbGwoKTsKICAgICAgICByZXF1ZXN0LnNldEF0dHJpYnV0ZSgic3VydmV5cyIsIHN1cnZleXMpOwogICAgICAgIHJlcXVlc3QuZ2V0UmVxdWVzdERpc3BhdGNoZXIoImluZGV4LmpzcCIpLmZvcndhcmQocmVxdWVzdCwgcmVzcG9uc2UpOwogICAgfQp9Cg==</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><a href="https://github.com/TwilioDevEd/automated-survey-servlet" target="_blank" class="explorer-get-code"> <i class="fa fa-lg fa-github-square"> </i>View Code on GitHub</a></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>